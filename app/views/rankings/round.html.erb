<% content_for :title, "Ranking - Rodada #{@round.number}" %>
<%= breadcrumb ["Inicio", root_path], ["Rankings", rankings_path], [@championship.full_name, championship_rankings_path(championship_id: @championship.id)], "Rodada #{@round.number}" %>

<div style="text-align: center; margin-bottom: 30px;">
  <h1 style="color: #000080;">Ranking - Rodada <%= @round.number %></h1>
  <p style="font-size: 18px; color: #666; margin-top: 10px;">
    <strong><%= @championship.full_name %></strong>
  </p>
  <div style="margin-top: 15px;">
    <%= link_to "← Voltar", championship_rankings_path(championship_id: @championship.id), class: "btn" %>
  </div>
</div>

<% if @round_scores.any? %>
  <!-- Pódio (Top 3) -->
  <div class="card">
    <h2 style="text-align: center; margin-bottom: 30px;">Pódio</h2>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px;">
      <% @round_scores.first(3).each_with_index do |score, index| %>
        <div style="text-align: center; padding: 30px; background: <%= index == 0 ? '#FFD700' : index == 1 ? '#C0C0C0' : '#CD7F32' %>; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <div style="font-size: 48px; margin-bottom: 10px;">
            <%= raw(index == 0 ? '&#129351;' : index == 1 ? '&#129352;' : '&#129353;') %>
          </div>
          <h3 style="color: #000; margin-bottom: 10px; font-size: 20px;"><%= score.user.name %></h3>
          <div style="font-size: 32px; font-weight: bold; color: #000; margin-bottom: 10px;">
            <%= score.total_points %> pts
          </div>
          <div style="color: #333; font-size: 14px; margin-bottom: 5px;">
            <strong><%= score.exact_scores + score.special_exact_scores %></strong> placares exatos
          </div>
          <div style="color: #333; font-size: 14px;">
            <strong><%= score.correct_results + score.special_correct_results %></strong> resultados corretos
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Classificação Completa -->
  <% if @round_scores.count > 3 %>
    <div class="card">
      <h2 style="text-align: center; margin-bottom: 20px;">Classificação Completa</h2>
      
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
        <% @round_scores[3..-1].each do |score| %>
          <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 15px;">
              <div style="font-size: 24px; font-weight: bold; color: #000080; min-width: 40px;">
                <%= score.position %>º
              </div>
              <div>
                <div style="font-weight: bold; font-size: 16px; color: #000;">
                  <%= score.user.name %>
                </div>
                <div style="color: #666; font-size: 14px; margin-top: 5px;">
                  <%= score.exact_scores + score.special_exact_scores %> exatos | 
                  <%= score.correct_results + score.special_correct_results %> corretos
                </div>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 24px; font-weight: bold; color: #000080;">
                <%= score.total_points %> pts
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% else %>
  <div class="card">
    <p style="text-align: center; color: #666;">Nenhuma pontuação disponível para esta rodada ainda.</p>
  </div>
<% end %>

<!-- Resultados dos Jogos -->
<div class="card">
  <h2 style="text-align: center; margin-bottom: 20px;">Resultados dos Jogos</h2>
  
  <% if @matches.any? %>
    <table>
      <thead>
        <tr>
          <th style="text-align: center;">Data/Hora</th>
          <th style="text-align: right;">Mandante</th>
          <th style="text-align: center;">Placar</th>
          <th>Visitante</th>
          <th style="text-align: center;">Status</th>
        </tr>
      </thead>
      <tbody>
        <% @matches.each do |match| %>
          <tr>
            <td style="text-align: center;"><%= match.scheduled_at&.strftime("%d/%m %H:%M") %></td>
            <td style="text-align: right;">
              <div style="display: flex; align-items: center; justify-content: flex-end; gap: 10px;">
                <strong><%= match.home_club.name %></strong>
                <% if match.home_club.badge_url %>
                  <%= image_tag match.home_club.badge_url, style: "width: 25px; height: 25px; object-fit: contain;" %>
                <% else %>
                  <div style="width: 25px; height: 25px; background: <%= match.home_club.primary_color %>; border-radius: 3px;"></div>
                <% end %>
              </div>
            </td>
            <td style="text-align: center;">
              <% if match.finished? %>
                <strong style="font-size: 18px; color: #000080;"><%= match.home_score %> x <%= match.away_score %></strong>
              <% else %>
                <span style="color: #999;">- x -</span>
              <% end %>
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <% if match.away_club.badge_url %>
                  <%= image_tag match.away_club.badge_url, style: "width: 25px; height: 25px; object-fit: contain;" %>
                <% else %>
                  <div style="width: 25px; height: 25px; background: <%= match.away_club.primary_color %>; border-radius: 3px;"></div>
                <% end %>
                <strong><%= match.away_club.name %></strong>
              </div>
            </td>
            <td style="text-align: center;">
              <span style="color: <%= match.status_color %>; font-weight: bold;">
                <%= match.status_label %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p style="text-align: center; color: #666;">Nenhuma partida cadastrada ainda.</p>
  <% end %>
</div>
