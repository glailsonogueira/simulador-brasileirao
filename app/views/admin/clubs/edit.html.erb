<% content_for :title, "Editar Clube" %>
<%= breadcrumb ["Inicio", root_path], ["Admin", admin_championships_path], ["Clubes", admin_clubs_path], "Editar" %>

<div style="text-align: center; margin-bottom: 30px;">
  <h1 style="color: #000080;">Editar Clube: <%= @club.name %></h1>
  <div style="margin-top: 15px;">
    <%= link_to "Voltar", admin_clubs_path, class: "btn", style: "margin: 0 5px;" %>
  </div>
</div>

<div class="card" style="max-width: 800px; margin: 0 auto;">
  <%= form_with model: @club, url: admin_club_path(@club), method: :patch, local: true do |f| %>
    <% if @club.errors.any? %>
      <div style="background: #f8d7da; color: #721c24; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
        <h4>Erros:</h4>
        <ul>
          <% @club.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
      <!-- Coluna Esquerda -->
      <div>
        <div style="margin-bottom: 15px;">
          <%= f.label :name, "Nome do Clube:", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <%= f.text_field :name, required: true, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" %>
        </div>

        <div style="margin-bottom: 15px;">
          <%= f.label :abbreviation, "Sigla:", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <%= f.text_field :abbreviation, required: true, maxlength: 3, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" %>
          <small style="color: #666;">Maximo 3 caracteres</small>
        </div>

        <div style="margin-bottom: 15px;">
          <%= f.label :primary_color, "Cor Principal:", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <div style="display: flex; gap: 10px; align-items: center;">
            <%= f.color_field :primary_color, id: "color_picker", style: "width: 60px; height: 60px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;" %>
            <%= f.text_field :primary_color, id: "color_hex", placeholder: "#000080", maxlength: 7, style: "flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; text-transform: uppercase;" %>
          </div>
          <small style="color: #666;">Clique no quadrado ou digite o codigo hex</small>
        </div>
      </div>

      <!-- Coluna Direita -->
      <div>
        <div style="margin-bottom: 15px;">
          <%= f.label :primary_stadium_id, "Estadio Principal:", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <%= f.collection_select :primary_stadium_id, Stadium.ordered, :id, :full_name, { prompt: "Selecione um estadio" }, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" %>
          <small style="color: #666;">Usado automaticamente em jogos como mandante</small>
        </div>

        <div style="margin-bottom: 15px;">
          <%= f.label :stadium_ids, "Outros Estadios:", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
          <%= f.collection_select :stadium_ids, Stadium.ordered, :id, :full_name, {}, { multiple: true, size: 5, style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" } %>
          <small style="color: #666;">Estadios alternativos (segure Ctrl para multipla selecao)</small>
        </div>
      </div>
    </div>

    <div style="margin-bottom: 15px;">
      <%= f.label :badge, "Escudo do Clube:", style: "display: block; font-weight: bold; margin-bottom: 5px;" %>
      <% if @club.badge_url %>
        <div style="margin: 10px 0;">
          <%= image_tag @club.badge_url, style: "width: 100px; height: 100px; object-fit: contain; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: white;" %>
        </div>
      <% end %>
      <%= f.file_field :badge, accept: "image/png,image/jpeg,image/jpg,image/svg+xml", style: "margin-top: 5px;" %>
      <small style="color: #666; display: block; margin-top: 5px;">Formatos aceitos: PNG, JPG, SVG</small>
    </div>

    <%= f.submit "Salvar Alteracoes", class: "btn", style: "width: auto; padding: 10px 30px; font-size: 16px; background: #28a745;" %>
  <% end %>
</div>

<script>
  (function() {
    function setupColorSync() {
      const colorPicker = document.getElementById('color_picker');
      const colorHex = document.getElementById('color_hex');
      
      if (!colorPicker || !colorHex) return;
      
      // Remover listeners antigos (se existirem)
      colorPicker.replaceWith(colorPicker.cloneNode(true));
      colorHex.replaceWith(colorHex.cloneNode(true));
      
      // Pegar os novos elementos
      const newColorPicker = document.getElementById('color_picker');
      const newColorHex = document.getElementById('color_hex');
      
      // Quando mudar o color picker, atualiza o campo hex
      newColorPicker.addEventListener('input', function() {
        newColorHex.value = this.value.toUpperCase();
      });
      
      // Quando digitar no campo hex, atualiza o color picker
      newColorHex.addEventListener('input', function() {
        let value = this.value.trim();
        
        // Adicionar # se não tiver
        if (value && !value.startsWith('#')) {
          value = '#' + value;
          this.value = value;
        }
        
        // Validar e atualizar picker se for hex válido
        if (/^#[0-9A-F]{6}$/i.test(value)) {
          newColorPicker.value = value;
        }
      });
      
      // Forçar uppercase ao sair do campo
      newColorHex.addEventListener('blur', function() {
        this.value = this.value.toUpperCase();
      });
    }
    
    // Executar no load e no turbo:load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupColorSync);
    } else {
      setupColorSync();
    }
    
    document.addEventListener('turbo:load', setupColorSync);
  })();
</script>
