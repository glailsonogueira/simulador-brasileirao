<% content_for :title, @championship.full_name %>
<%= breadcrumb ["Inicio", root_path], ["Admin", admin_championships_path], @championship.full_name %>

<div style="text-align: center; margin-bottom: 30px;">
  <h1 style="color: #000080; margin-bottom: 10px;"><%= @championship.full_name %></h1>
  <div>
    <%= link_to "Voltar", admin_championships_path, class: "btn", style: "margin: 0 5px;" %>
    <%= link_to "Editar", edit_admin_championship_path(@championship), class: "btn", style: "margin: 0 5px;" %>
  </div>
</div>

<div class="card">
  <h2 style="text-align: center; margin-bottom: 20px;">Informacoes do Campeonato</h2>
  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
    <div>
      <p style="color: #666; font-size: 14px;">Ano</p>
      <p style="font-size: 24px; font-weight: bold; color: #000080;"><%= @championship.year %></p>
    </div>
    <div>
      <p style="color: #666; font-size: 14px;">Status</p>
      <p style="font-size: 24px; font-weight: bold; color: <%= @championship.active? ? '#28a745' : '#dc3545' %>;">
        <%= @championship.active? ? "Ativo" : "Inativo" %>
      </p>
    </div>
    <div>
      <p style="color: #666; font-size: 14px;">Rodadas</p>
      <p style="font-size: 24px; font-weight: bold; color: #000080;"><%= @championship.rounds.count %></p>
    </div>
  </div>
  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; text-align: center; margin-top: 20px;">
    <div>
      <p style="color: #666; font-size: 14px;">Data Inicio</p>
      <p style="font-size: 18px; font-weight: bold;"><%= @championship.start_date&.strftime("%d/%m/%Y") %></p>
    </div>
    <div>
      <p style="color: #666; font-size: 14px;">Data Fim</p>
      <p style="font-size: 18px; font-weight: bold;"><%= @championship.end_date&.strftime("%d/%m/%Y") %></p>
    </div>
  </div>
</div>

<div class="card">
  <h2 style="text-align: center; margin-bottom: 20px;">
    Clubes Participantes (<%= @championship.clubs_count %>/20)
  </h2>
  
  <% if @championship.can_add_club? %>
    <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
      <%= form_with url: admin_championship_add_club_path(@championship), method: :post, local: true, style: "display: inline-flex; gap: 10px; align-items: center;" do |f| %>
        <%= select_tag :club_id, options_from_collection_for_select(Club.where.not(id: @championship.clubs.pluck(:id)).ordered, :id, :name), prompt: "Selecione um clube", style: "padding: 10px; border: 1px solid #ddd; border-radius: 5px;" %>
        <%= f.submit "Adicionar Clube", class: "btn" %>
      <% end %>
    </div>
  <% end %>
  
  <% if @championship.clubs.any? %>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px;">
      <% @championship.clubs.ordered.each_slice(10).each do |clubs_column| %>
        <div>
          <% clubs_column.each do |club| %>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <% if club.badge_url %>
                  <%= image_tag club.badge_url, style: "width: 30px; height: 30px; object-fit: contain;" %>
                <% else %>
                  <div style="width: 30px; height: 30px; background: <%= club.primary_color || '#ccc' %>; border-radius: 3px;"></div>
                <% end %>
                <strong><%= club.name %></strong>
                <span style="color: #666; font-size: 12px;">(<%= club.abbreviation %>)</span>
                <% if club.special_club? %>
                  <span style="color: #ffc107; font-size: 16px;">&#9733;</span>
                <% end %>
              </div>
              <%= button_to "X", admin_championship_remove_club_path(@championship, club_id: club.id), method: :delete, data: { confirm: "Remover #{club.name}?" }, class: "btn btn-danger", style: "padding: 5px 10px; font-size: 12px;" %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p style="text-align: center; color: #666;">Nenhum clube adicionado ainda.</p>
  <% end %>
  
  <% if @championship.complete? && @championship.rounds.count == 0 %>
    <div style="text-align: center; margin-top: 30px;">
      <%= button_to "Gerar 38 Rodadas", generate_rounds_admin_championship_path(@championship), method: :post, class: "btn", style: "background: #28a745; font-size: 16px; padding: 15px 30px;", data: { confirm: "Gerar 38 rodadas agora?" } %>
    </div>
  <% end %>
</div>

<% if @championship.rounds.any? %>
  <div class="card">
    <h2 style="text-align: center; margin-bottom: 20px;">Rodadas (<%= @championship.rounds.count %>)</h2>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
      <% @championship.rounds.order(:number).each do |round| %>
        <div class="card" style="background: #f8f9fa; text-align: center; padding: 20px;">
          <h3 style="color: #000080; margin-bottom: 15px; font-size: 20px;">
            Rodada <%= round.number %>
          </h3>
          
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <%= link_to "Partidas", admin_round_matches_path(round), class: "btn", style: "width: 100%;" %>
            <%= link_to "Resultados", admin_round_results_path(round), class: "btn", style: "width: 100%; background: #28a745;" %>
          </div>
          
          <div style="margin-top: 15px; font-size: 12px; color: #666;">
            <% matches_count = round.matches.count %>
            <% finished_count = round.matches.where(finished: true).count %>
            <p><%= matches_count %> partida(s)</p>
            <% if finished_count > 0 %>
              <p style="color: #28a745;"><%= finished_count %> finalizada(s)</p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
